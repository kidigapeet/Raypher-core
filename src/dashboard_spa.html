<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Raypher Command Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        :root {
            --bg: #060a13;
            --bg2: #0c1221;
            --bg3: #111827;
            --card: rgba(15, 23, 42, .55);
            --card-border: rgba(148, 163, 184, .1);
            --blue: #3b82f6;
            --green: #10b981;
            --amber: #f59e0b;
            --red: #ef4444;
            --cyan: #06b6d4;
            --purple: #8b5cf6;
            --text: #e2e8f0;
            --text2: #94a3b8;
            --text3: #64748b;
            --radius: 14px;
            --radius-sm: 8px;
        }

        html,
        body {
            height: 100%;
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden
        }

        body {
            display: flex;
            flex-direction: column
        }

        ::-webkit-scrollbar {
            width: 6px
        }

        ::-webkit-scrollbar-track {
            background: transparent
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text3);
            border-radius: 3px
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: var(--bg2);
            border-bottom: 1px solid var(--card-border);
            flex-shrink: 0;
            z-index: 100
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px
        }

        .brand svg {
            width: 28px;
            height: 28px
        }

        .brand h1 {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: -.5px
        }

        .brand span {
            font-size: 11px;
            color: var(--text3);
            font-weight: 400;
            margin-left: 4px
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px
        }

        .status-pill {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(16, 185, 129, .1);
            color: var(--green);
            border: 1px solid rgba(16, 185, 129, .2)
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--green);
            animation: pulse 2s infinite
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: .4
            }
        }

        .panic-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 10px;
            border: 1px solid rgba(239, 68, 68, .4);
            background: rgba(239, 68, 68, .1);
            color: var(--red);
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all .2s;
            text-transform: uppercase;
            letter-spacing: .5px
        }

        .panic-btn:hover {
            background: rgba(239, 68, 68, .25);
            box-shadow: 0 0 20px rgba(239, 68, 68, .2);
            transform: scale(1.03)
        }

        /* Shell */
        .shell {
            display: flex;
            flex: 1;
            overflow: hidden
        }

        /* Icon Nav Sidebar */
        .nav-sidebar {
            width: 72px;
            background: var(--bg2);
            border-right: 1px solid var(--card-border);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 0;
            flex-shrink: 0;
            gap: 4px
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            padding: 10px 6px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all .15s;
            width: 60px;
            text-align: center;
            border: 1px solid transparent
        }

        .nav-item:hover {
            background: rgba(148, 163, 184, .08)
        }

        .nav-item.active {
            background: rgba(59, 130, 246, .1);
            border-color: rgba(59, 130, 246, .3);
            color: var(--blue)
        }

        .nav-item .nav-icon {
            font-size: 20px;
            line-height: 1
        }

        .nav-item .nav-label {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .5px;
            color: var(--text3)
        }

        .nav-item.active .nav-label {
            color: var(--blue)
        }

        .nav-spacer {
            flex: 1
        }

        .nav-stats {
            padding: 8px 6px;
            font-size: 9px;
            color: var(--text3);
            text-align: center;
            line-height: 1.8
        }

        .nav-stats b {
            color: var(--text2);
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px
        }

        /* Main Panel */
        .main {
            flex: 1;
            overflow-y: auto;
            padding: 20px 28px
        }

        .panel {
            display: none
        }

        .panel.active {
            display: block
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px
        }

        .panel-title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--card-border);
            background: transparent;
            color: var(--text2);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all .15s
        }

        .back-btn:hover {
            background: rgba(148, 163, 184, .08);
            border-color: var(--text2)
        }

        /* Cards */
        .card {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
            backdrop-filter: blur(12px)
        }

        .card-title {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: .5px;
            color: var(--text2);
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px
        }

        /* Agent Grid */
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 14px
        }

        .agent-tile {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: var(--radius);
            padding: 16px;
            cursor: pointer;
            transition: all .2s
        }

        .agent-tile:hover {
            border-color: var(--blue);
            background: rgba(59, 130, 246, .04);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, .3)
        }

        .agent-tile-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px
        }

        .agent-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0
        }

        .agent-dot.safe {
            background: var(--green)
        }

        .agent-dot.warn {
            background: var(--amber)
        }

        .agent-dot.danger {
            background: var(--red)
        }

        .agent-tile-name {
            font-size: 14px;
            font-weight: 600;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis
        }

        .agent-tile-pid {
            font-size: 10px;
            color: var(--text3);
            font-family: 'JetBrains Mono', monospace
        }

        .agent-tile-meta {
            display: flex;
            gap: 12px;
            font-size: 11px;
            color: var(--text3);
            margin-bottom: 8px
        }

        .agent-tile-meta span {
            display: flex;
            align-items: center;
            gap: 4px
        }

        .agent-tile-risk {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: .5px;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block
        }

        .agent-tile-risk.safe {
            background: rgba(16, 185, 129, .12);
            color: var(--green)
        }

        .agent-tile-risk.warn {
            background: rgba(245, 158, 11, .12);
            color: var(--amber)
        }

        .agent-tile-risk.danger {
            background: rgba(239, 68, 68, .12);
            color: var(--red)
        }

        .agent-empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px;
            color: var(--text3)
        }

        .agent-empty-state p {
            font-size: 14px;
            margin-top: 8px
        }

        /* Agent Detail */
        .detail-header-card {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap
        }

        .detail-gauge {
            display: flex;
            flex-direction: column;
            align-items: center
        }

        .detail-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 16px 0
        }

        .detail-stat {
            padding: 12px;
            background: rgba(148, 163, 184, .04);
            border-radius: var(--radius-sm);
            text-align: center
        }

        .detail-stat-val {
            font-size: 18px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace
        }

        .detail-stat-lbl {
            font-size: 10px;
            color: var(--text3);
            margin-top: 2px
        }

        .freeze-btn {
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            border: 1px solid rgba(239, 68, 68, .4);
            background: rgba(239, 68, 68, .08);
            color: var(--red);
            font-weight: 700;
            font-size: 12px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all .2s
        }

        .freeze-btn:hover {
            background: rgba(239, 68, 68, .2)
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 24px
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 7px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--card-border)
        }

        .event-row {
            position: relative;
            padding: 10px 0 10px 16px;
            border-bottom: 1px solid rgba(148, 163, 184, .05);
            cursor: pointer;
            transition: background .1s
        }

        .event-row:hover {
            background: rgba(148, 163, 184, .03);
            border-radius: var(--radius-sm)
        }

        .event-dot {
            position: absolute;
            left: -20px;
            top: 14px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid var(--bg)
        }

        .event-dot.INFO {
            background: var(--green)
        }

        .event-dot.WARNING {
            background: var(--amber)
        }

        .event-dot.CRITICAL {
            background: var(--red)
        }

        .event-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 4px
        }

        .event-type {
            font-size: 11px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--cyan)
        }

        .event-badge {
            font-size: 9px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            text-transform: uppercase
        }

        .event-badge.INFO {
            background: rgba(16, 185, 129, .15);
            color: var(--green)
        }

        .event-badge.WARNING {
            background: rgba(245, 158, 11, .15);
            color: var(--amber)
        }

        .event-badge.CRITICAL {
            background: rgba(239, 68, 68, .15);
            color: var(--red)
        }

        .event-time {
            font-size: 10px;
            color: var(--text3);
            font-family: 'JetBrains Mono', monospace;
            margin-left: auto
        }

        .event-detail {
            font-size: 12px;
            color: var(--text2);
            line-height: 1.5;
            max-width: 700px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis
        }

        .event-expand {
            display: none;
            margin-top: 8px;
            padding: 10px;
            background: rgba(6, 10, 19, .5);
            border-radius: var(--radius-sm);
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--cyan);
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto
        }

        .event-row.expanded .event-expand {
            display: block
        }

        .event-row.expanded .event-detail {
            white-space: normal
        }

        .event-filters {
            display: flex;
            gap: 6px;
            margin-bottom: 14px;
            flex-wrap: wrap
        }

        .filter-btn {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid var(--card-border);
            background: transparent;
            color: var(--text3);
            cursor: pointer;
            transition: all .15s;
            font-family: 'Inter', sans-serif
        }

        .filter-btn:hover {
            border-color: var(--text2);
            color: var(--text2)
        }

        .filter-btn.active {
            background: rgba(59, 130, 246, .15);
            border-color: var(--blue);
            color: var(--blue)
        }

        /* Kanban */
        .kanban {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 14px;
            margin-bottom: 20px
        }

        .kanban-col {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: var(--radius);
            padding: 14px;
            min-height: 260px;
            display: flex;
            flex-direction: column
        }

        .kanban-header {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid
        }

        .kanban-header.allowed {
            color: var(--green);
            border-color: var(--green)
        }

        .kanban-header.askme {
            color: var(--amber);
            border-color: var(--amber)
        }

        .kanban-header.blocked {
            color: var(--red);
            border-color: var(--red)
        }

        .kanban-cards {
            flex: 1
        }

        .cap-card {
            background: rgba(148, 163, 184, .06);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-sm);
            padding: 10px 12px;
            margin-bottom: 6px;
            cursor: grab;
            transition: all .15s;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        .cap-card:hover {
            border-color: var(--blue);
            background: rgba(59, 130, 246, .06)
        }

        .cap-card.dragging {
            opacity: .4;
            border-style: dashed
        }

        .cap-card-info {
            flex: 1;
            min-width: 0
        }

        .cap-card-name {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 2px
        }

        .cap-card-desc {
            font-size: 10px;
            color: var(--text3)
        }

        .cap-remove {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: none;
            background: transparent;
            color: var(--text3);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            opacity: 0;
            transition: all .15s
        }

        .cap-card:hover .cap-remove {
            opacity: 1
        }

        .cap-remove:hover {
            color: var(--red);
            background: rgba(239, 68, 68, .1)
        }

        .kanban-col.drag-over {
            background: rgba(59, 130, 246, .06);
            border-color: var(--blue)
        }

        .kanban-add {
            display: flex;
            gap: 6px;
            margin-top: auto;
            padding-top: 8px
        }

        .kanban-add input {
            flex: 1;
            padding: 6px 10px;
            background: rgba(148, 163, 184, .06);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-sm);
            color: var(--text);
            font-size: 11px;
            font-family: 'Inter', sans-serif;
            outline: none
        }

        .kanban-add input:focus {
            border-color: var(--blue)
        }

        .kanban-add input::placeholder {
            color: var(--text3)
        }

        /* Budget */
        .budget-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px
        }

        .budget-bar {
            height: 10px;
            background: rgba(148, 163, 184, .1);
            border-radius: 5px;
            overflow: hidden;
            margin: 8px 0
        }

        .budget-fill {
            height: 100%;
            border-radius: 5px;
            transition: width .5s;
            background: linear-gradient(90deg, var(--green), var(--amber))
        }

        .budget-big {
            font-size: 28px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace
        }

        .budget-sub {
            font-size: 12px;
            color: var(--text3)
        }

        input[type=range] {
            width: 100%;
            accent-color: var(--blue);
            margin: 6px 0
        }

        .toggle {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px
        }

        .toggle input {
            display: none
        }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: rgba(148, 163, 184, .2);
            border-radius: 11px;
            cursor: pointer;
            transition: .2s
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: .2s
        }

        .toggle input:checked+.toggle-slider {
            background: var(--blue)
        }

        .toggle input:checked+.toggle-slider::before {
            transform: translateX(18px)
        }

        .bar-chart {
            padding: 6px 0
        }

        .bar-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px
        }

        .bar-label {
            font-size: 11px;
            width: 80px;
            color: var(--text2);
            text-align: right;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis
        }

        .bar-track {
            flex: 1;
            height: 8px;
            background: rgba(148, 163, 184, .08);
            border-radius: 4px;
            overflow: hidden
        }

        .bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width .5s
        }

        .bar-count {
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text3);
            width: 50px
        }

        /* Vault */
        .vault-form {
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            gap: 10px;
            align-items: end;
            margin-bottom: 16px
        }

        .vault-form label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text2);
            margin-bottom: 4px;
            display: block
        }

        .vault-form select,
        .vault-form input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(148, 163, 184, .06);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-sm);
            color: var(--text);
            font-size: 12px;
            font-family: 'Inter', sans-serif;
            outline: none
        }

        .vault-form select:focus,
        .vault-form input:focus {
            border-color: var(--blue)
        }

        .vault-form select option {
            background: var(--bg2)
        }

        .seal-btn {
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--blue), var(--purple));
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all .2s;
            white-space: nowrap
        }

        .seal-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, .3)
        }

        .secret-row {
            display: flex;
            align-items: center;
            padding: 10px 14px;
            border-bottom: 1px solid rgba(148, 163, 184, .06)
        }

        .secret-row:last-child {
            border-bottom: none
        }

        .secret-icon {
            font-size: 18px;
            margin-right: 10px
        }

        .secret-info {
            flex: 1
        }

        .secret-provider {
            font-size: 13px;
            font-weight: 600
        }

        .secret-date {
            font-size: 10px;
            color: var(--text3)
        }

        .secret-badge {
            font-size: 9px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(16, 185, 129, .12);
            color: var(--green);
            margin-right: 10px;
            text-transform: uppercase
        }

        .secret-delete {
            padding: 4px 10px;
            border: 1px solid rgba(239, 68, 68, .3);
            background: transparent;
            border-radius: var(--radius-sm);
            color: var(--red);
            font-size: 11px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all .15s
        }

        .secret-delete:hover {
            background: rgba(239, 68, 68, .1)
        }

        .vault-banner {
            padding: 12px 16px;
            background: rgba(6, 182, 212, .06);
            border: 1px solid rgba(6, 182, 212, .15);
            border-radius: var(--radius-sm);
            font-size: 11px;
            color: var(--cyan);
            line-height: 1.6;
            margin-top: 12px
        }

        /* Settings */
        .settings-section {
            margin-bottom: 12px
        }

        .settings-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: background .1s
        }

        .settings-header:hover {
            background: rgba(148, 163, 184, .05)
        }

        .settings-header h3 {
            font-size: 13px;
            font-weight: 600
        }

        .settings-chevron {
            color: var(--text3);
            transition: transform .2s;
            font-size: 12px
        }

        .settings-section.open .settings-chevron {
            transform: rotate(90deg)
        }

        .settings-body {
            display: none;
            padding: 0 14px 14px
        }

        .settings-section.open .settings-body {
            display: block
        }

        .field-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(148, 163, 184, .05)
        }

        .field-label {
            font-size: 12px;
            color: var(--text2)
        }

        .field-input {
            padding: 6px 10px;
            background: rgba(148, 163, 184, .06);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-sm);
            color: var(--text);
            font-size: 12px;
            font-family: 'JetBrains Mono', monospace;
            outline: none;
            width: 180px;
            text-align: right
        }

        .field-input:focus {
            border-color: var(--blue)
        }

        .field-select {
            padding: 6px 10px;
            background: rgba(148, 163, 184, .06);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-sm);
            color: var(--text);
            font-size: 12px;
            font-family: 'Inter', sans-serif;
            outline: none
        }

        .field-select option {
            background: var(--bg2)
        }

        /* DLP Panel */
        .dlp-overview {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px
        }

        .dlp-stat-card {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            transition: all .2s
        }

        .dlp-stat-card:hover {
            border-color: var(--blue);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, .3)
        }

        .dlp-stat-big {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -1px;
            margin-bottom: 4px
        }

        .dlp-stat-label {
            font-size: 11px;
            color: var(--text3);
            text-transform: uppercase;
            letter-spacing: .5px
        }

        .dlp-category-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: .3px;
            text-transform: uppercase
        }

        .dlp-cat-api_keys {
            background: rgba(239, 68, 68, .15);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, .3)
        }

        .dlp-cat-financial {
            background: rgba(245, 158, 11, .15);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, .3)
        }

        .dlp-cat-pii {
            background: rgba(139, 92, 246, .15);
            color: #a78bfa;
            border: 1px solid rgba(139, 92, 246, .3)
        }

        .dlp-cat-crypto_material {
            background: rgba(236, 72, 153, .15);
            color: #f472b6;
            border: 1px solid rgba(236, 72, 153, .3)
        }

        .dlp-cat-entropy {
            background: rgba(6, 182, 212, .15);
            color: #22d3ee;
            border: 1px solid rgba(6, 182, 212, .3)
        }

        .dlp-action-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: .3px
        }

        .dlp-action-redact {
            background: rgba(245, 158, 11, .15);
            color: #fbbf24
        }

        .dlp-action-block {
            background: rgba(239, 68, 68, .15);
            color: #f87171
        }

        .dlp-action-alert {
            background: rgba(59, 130, 246, .15);
            color: #60a5fa
        }

        .dlp-action-allow {
            background: rgba(16, 185, 129, .15);
            color: #34d399
        }

        .dlp-finding-row {
            display: grid;
            grid-template-columns: 140px 80px 120px 1fr 100px 80px;
            gap: 12px;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--card-border);
            font-size: 12px;
            transition: background .15s
        }

        .dlp-finding-row:hover {
            background: rgba(148, 163, 184, .04)
        }

        .dlp-finding-row:last-child {
            border-bottom: none
        }

        .dlp-finding-header {
            font-weight: 700;
            color: var(--text3);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: .5px;
            padding: 10px 16px;
            background: rgba(148, 163, 184, .04);
            border-bottom: 1px solid var(--card-border);
            border-radius: var(--radius) var(--radius) 0 0
        }

        .dlp-snippet {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text2);
            background: rgba(0, 0, 0, .2);
            padding: 2px 6px;
            border-radius: 4px;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap
        }

        .dlp-direction {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase
        }

        .dlp-dir-outbound {
            color: #f87171
        }

        .dlp-dir-inbound {
            color: #60a5fa
        }

        .dlp-donut-container {
            display: flex;
            align-items: center;
            gap: 24px;
            margin: 16px 0
        }

        .dlp-legend {
            display: flex;
            flex-direction: column;
            gap: 8px
        }

        .dlp-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text2)
        }

        .dlp-legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0
        }

        .dlp-config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px
        }

        .dlp-config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(148, 163, 184, .04);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-sm)
        }

        .dlp-config-label {
            font-size: 12px;
            color: var(--text2)
        }

        .dlp-config-value {
            font-size: 12px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--cyan)
        }

        .save-bar {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 12px 0
        }

        .btn-primary {
            padding: 8px 20px;
            background: var(--blue);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all .15s
        }

        .btn-primary:hover {
            background: #2563eb
        }

        .btn-primary:disabled {
            opacity: .4;
            cursor: not-allowed
        }

        .btn-secondary {
            padding: 8px 20px;
            background: transparent;
            border: 1px solid var(--card-border);
            border-radius: var(--radius-sm);
            color: var(--text2);
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all .15s
        }

        .btn-secondary:hover {
            border-color: var(--text2)
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column-reverse;
            gap: 8px
        }

        .toast {
            padding: 10px 16px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: slideIn .3s ease;
            min-width: 250px;
            backdrop-filter: blur(12px);
            border: 1px solid
        }

        .toast.success {
            background: rgba(16, 185, 129, .12);
            color: var(--green);
            border-color: rgba(16, 185, 129, .2)
        }

        .toast.error {
            background: rgba(239, 68, 68, .12);
            color: var(--red);
            border-color: rgba(239, 68, 68, .2)
        }

        .toast.warning {
            background: rgba(245, 158, 11, .12);
            color: var(--amber);
            border-color: rgba(245, 158, 11, .2)
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0
            }

            to {
                transform: translateX(0);
                opacity: 1
            }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .6);
            z-index: 9998;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px)
        }

        .modal-overlay.active {
            display: flex
        }

        .modal {
            background: var(--bg2);
            border: 1px solid var(--card-border);
            border-radius: var(--radius);
            padding: 24px;
            max-width: 400px;
            width: 90%;
            text-align: center
        }

        .modal h2 {
            font-size: 16px;
            margin-bottom: 8px
        }

        .modal p {
            font-size: 13px;
            color: var(--text2);
            margin-bottom: 16px;
            line-height: 1.5
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text3)
        }

        .empty-state p {
            font-size: 13px
        }

        .gauge-svg {
            width: 140px;
            height: 78px
        }
    </style>
</head>

<body>

    <!-- HEADER -->
    <header class="header">
        <div class="brand">
            <svg viewBox="0 0 28 28" fill="none">
                <rect x="2" y="2" width="24" height="24" rx="6" stroke="#3b82f6" stroke-width="2" />
                <path d="M9 9h4v4H9zM15 9h4v4h-4zM9 15h4v4H9z" fill="#3b82f6" opacity=".6" />
                <path d="M15 15h4v4h-4z" fill="#3b82f6" />
            </svg>
            <h1>RAYPHER<span>Command Center</span></h1>
        </div>
        <div class="header-right">
            <div class="status-pill">
                <div class="status-dot"></div>PROTECTED
            </div>
            <button class="panic-btn" onclick="showPanicModal()">‚ö° FREEZE ALL</button>
        </div>
    </header>

    <!-- SHELL -->
    <div class="shell">

        <!-- Icon Nav Sidebar -->
        <nav class="nav-sidebar">
            <div class="nav-item active" data-panel="agents" onclick="switchPanel('agents')">
                <div class="nav-icon">üîç</div>
                <div class="nav-label">Agents</div>
            </div>
            <div class="nav-item" data-panel="discovery" onclick="switchPanel('discovery')">
                <div class="nav-icon">üì°</div>
                <div class="nav-label">Shadow AI</div>
            </div>
            <div class="nav-item" data-panel="zones" onclick="switchPanel('zones')">
                <div class="nav-icon">üéØ</div>
                <div class="nav-label">Zones</div>
            </div>
            <div class="nav-item" data-panel="budget" onclick="switchPanel('budget')">
                <div class="nav-icon">üí∞</div>
                <div class="nav-label">Budget</div>
            </div>
            <div class="nav-item" data-panel="vault" onclick="switchPanel('vault')">
                <div class="nav-icon">üîê</div>
                <div class="nav-label">Vault</div>
            </div>
            <div class="nav-item" data-panel="dlp" onclick="switchPanel('dlp')">
                <div class="nav-icon">üõ°Ô∏è</div>
                <div class="nav-label">DLP</div>
            </div>
            <div class="nav-item" data-panel="merkle" onclick="switchPanel('merkle')">
                <div class="nav-icon">‚õìÔ∏è</div>
                <div class="nav-label">Ledger</div>
            </div>
            <div class="nav-item" data-panel="settings" onclick="switchPanel('settings')">
                <div class="nav-icon">‚öôÔ∏è</div>
                <div class="nav-label">Settings</div>
            </div>
            <div class="nav-spacer"></div>
            <div class="nav-stats">
                <div>Events <b id="stat-events">‚Äî</b></div>
                <div>Secrets <b id="stat-secrets">‚Äî</b></div>
                <div>Uptime <b id="stat-uptime">‚Äî</b></div>
                <div><b id="stat-version">‚Äî</b></div>
            </div>
        </nav>

        <!-- Main Panel -->
        <div class="main">

            <!-- PANEL: AGENTS (Grid) -->
            <div id="panel-agents" class="panel active">
                <div class="panel-header">
                    <div class="panel-title">üîç Agent Discovery</div>
                </div>
                <div id="agent-grid" class="agent-grid">
                    <div class="agent-empty-state">
                        <p>Scanning for AI agents...</p>
                    </div>
                </div>
            </div>

            <!-- PANEL: DISCOVERY -->
            <div id="panel-discovery" class="panel">
                <div class="panel-header">
                    <div class="panel-title">üì° Shadow AI Discovery</div>
                    <button class="btn-primary" onclick="loadDiscovery()">Refresh Scan</button>
                </div>
                <div class="card">
                    <div class="card-title">üîç Detected AI Infrastructure</div>
                    <div id="discovery-list">
                        <div class="empty-state">
                            <p>Loading discovery data...</p>
                        </div>
                    </div>
                    <div class="vault-banner" style="margin-top:20px">
                        üïµÔ∏è Shadow AI Discovery identifies unauthorized AI services running on this machine or reachable
                        over the network.
                    </div>
                </div>
            </div>

            <!-- PANEL: MERKLE LEDGER -->
            <div id="panel-merkle" class="panel">
                <div class="panel-header">
                    <div class="panel-title">‚õìÔ∏è Merkle-Chained Audit Ledger</div>
                    <button class="btn-primary" onclick="loadMerkle()">Refresh</button>
                </div>
                <div class="card" style="margin-bottom:16px">
                    <div class="card-title">Chain Integrity Status</div>
                    <div id="merkle-status-bar" style="display:flex;align-items:center;gap:16px;padding:16px 0">
                        <div style="font-size:36px" id="merkle-status-icon">‚è≥</div>
                        <div>
                            <div style="font-size:16px;font-weight:700" id="merkle-status-text">Loading...</div>
                            <div style="font-size:12px;color:var(--text2);margin-top:4px" id="merkle-entry-count"></div>
                            <div style="font-size:11px;color:var(--text3);margin-top:2px;font-family:'JetBrains Mono',monospace"
                                id="merkle-ledger-path"></div>
                        </div>
                    </div>
                    <div id="merkle-error-msg"
                        style="display:none;padding:10px;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);border-radius:8px;font-size:12px;color:var(--red);font-family:'JetBrains Mono',monospace">
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">Last Audit Entries</div>
                    <div id="merkle-entries">
                        <div class="empty-state">
                            <p>Loading ledger entries...</p>
                        </div>
                    </div>
                    <div class="vault-banner" style="margin-top:16px">üîê Each entry is SHA-256 hashed and chained ‚Äî any
                        tampering is instantly detectable via the <code
                            style="font-size:11px;color:var(--cyan)">raypher merkle-verify</code> command.</div>
                </div>
            </div>

            <!-- PANEL: AGENT DETAIL -->
            <div id="panel-agent-detail" class="panel">
                <div class="panel-header">
                    <button class="back-btn" onclick="switchPanel('agents')">‚Üê All Agents</button>
                    <button class="freeze-btn" id="detail-freeze-btn" onclick="freezeSelectedAgent()">‚ö° FREEZE</button>
                </div>
                <div class="card">
                    <div class="detail-header-card">
                        <div style="flex:1">
                            <div style="font-size:18px;font-weight:700;margin-bottom:4px" id="detail-name">‚Äî</div>
                            <span class="agent-tile-risk" id="detail-risk-badge">‚Äî</span>
                            <span style="font-size:11px;color:var(--text3);margin-left:8px"
                                id="detail-risk-reason"></span>
                        </div>
                        <div class="detail-gauge">
                            <svg class="gauge-svg" viewBox="0 0 160 90">
                                <path d="M15 80 A65 65 0 0 1 145 80" fill="none" stroke="rgba(148,163,184,.1)"
                                    stroke-width="12" stroke-linecap="round" />
                                <path d="M15 80 A65 65 0 0 1 145 80" fill="none" stroke="url(#gGrad)" stroke-width="12"
                                    stroke-linecap="round" id="detail-gauge-arc" stroke-dasharray="0 204" />
                                <defs>
                                    <linearGradient id="gGrad">
                                        <stop offset="0%" stop-color="#ef4444" />
                                        <stop offset="50%" stop-color="#f59e0b" />
                                        <stop offset="100%" stop-color="#10b981" />
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div style="font-size:20px;font-weight:800;text-align:center" id="detail-trust">‚Äî</div>
                            <div style="font-size:10px;color:var(--text3);text-align:center" id="detail-trust-lbl">Trust
                                Score</div>
                        </div>
                    </div>
                    <div class="detail-stats">
                        <div class="detail-stat">
                            <div class="detail-stat-val" id="detail-pid">‚Äî</div>
                            <div class="detail-stat-lbl">PID</div>
                        </div>
                        <div class="detail-stat">
                            <div class="detail-stat-val" id="detail-mem">‚Äî</div>
                            <div class="detail-stat-lbl">Memory</div>
                        </div>
                        <div class="detail-stat">
                            <div class="detail-stat-val" id="detail-cmd" style="font-size:10px;word-break:break-all">‚Äî
                            </div>
                            <div class="detail-stat-lbl">Command</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">üì° Audit Log</div>
                    <div class="event-filters" id="detail-filters">
                        <button class="filter-btn active" data-filter="all"
                            onclick="filterDetailEvents('all',this)">All</button>
                        <button class="filter-btn" data-filter="INFO"
                            onclick="filterDetailEvents('INFO',this)">Authorized</button>
                        <button class="filter-btn" data-filter="WARNING"
                            onclick="filterDetailEvents('WARNING',this)">Warnings</button>
                        <button class="filter-btn" data-filter="CRITICAL"
                            onclick="filterDetailEvents('CRITICAL',this)">Blocked</button>
                    </div>
                    <div class="timeline" id="detail-timeline">
                        <div class="empty-state">
                            <p>Loading events...</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">üõ°Ô∏è Security Insights</div>
                    <div id="detail-insights">
                        <div class="empty-state">
                            <p>Analyzing agent behavior...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PANEL: ZONES -->
            <div id="panel-zones" class="panel">
                <div class="panel-header">
                    <div class="panel-title">üéØ Capability Zones</div>
                </div>
                <div class="kanban">
                    <div class="kanban-col" id="zone-allowed" ondrop="dropCap(event,'allowed')"
                        ondragover="event.preventDefault();this.classList.add('drag-over')"
                        ondragleave="this.classList.remove('drag-over')">
                        <div class="kanban-header allowed">‚úÖ Allowed</div>
                        <div class="kanban-cards" id="cards-allowed"></div>
                        <div class="kanban-add"><input placeholder="+ Add capability..."
                                onkeydown="addCapability(event,'allowed')"></div>
                    </div>
                    <div class="kanban-col" id="zone-askme" ondrop="dropCap(event,'ask_me')"
                        ondragover="event.preventDefault();this.classList.add('drag-over')"
                        ondragleave="this.classList.remove('drag-over')">
                        <div class="kanban-header askme">‚úã Ask Me</div>
                        <div class="kanban-cards" id="cards-askme"></div>
                        <div class="kanban-add"><input placeholder="+ Add capability..."
                                onkeydown="addCapability(event,'ask_me')"></div>
                    </div>
                    <div class="kanban-col" id="zone-blocked" ondrop="dropCap(event,'blocked')"
                        ondragover="event.preventDefault();this.classList.add('drag-over')"
                        ondragleave="this.classList.remove('drag-over')">
                        <div class="kanban-header blocked">‚õî Blocked</div>
                        <div class="kanban-cards" id="cards-blocked"></div>
                        <div class="kanban-add"><input placeholder="+ Add capability..."
                                onkeydown="addCapability(event,'blocked')"></div>
                    </div>
                </div>
            </div>

            <!-- PANEL: BUDGET -->
            <div id="panel-budget" class="panel">
                <div class="panel-header">
                    <div class="panel-title">üí∞ Budget & Spend Analytics</div>
                </div>
                <div class="budget-grid">
                    <div class="card">
                        <div class="card-title">üìä Daily Spend</div>
                        <div class="budget-big" id="b-daily-spend">$0.00</div>
                        <div class="budget-sub">of <span id="b-daily-limit">$50.00</span> daily limit</div>
                        <div class="budget-bar">
                            <div class="budget-fill" id="b-daily-fill" style="width:0%"></div>
                        </div>
                        <input type="range" id="b-slider" min="1" max="500" value="50"
                            oninput="updateBudgetSlider(this.value)">
                    </div>
                    <div class="card">
                        <div class="card-title">üìà Monthly Total</div>
                        <div class="budget-big" id="b-monthly">$0.00</div>
                        <div class="budget-sub" id="b-monthly-sub">Estimated from daily rates</div>
                    </div>
                    <div class="card">
                        <div class="card-title">üïê Hourly Breakdown (Today)</div>
                        <div class="bar-chart" id="b-hourly-chart">
                            <div class="empty-state">
                                <p>Collecting data...</p>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">üìÖ Daily Breakdown (This Week)</div>
                        <div class="bar-chart" id="b-daily-chart">
                            <div class="empty-state">
                                <p>Collecting data...</p>
                            </div>
                        </div>
                    </div>
                    <div class="card" style="grid-column:span 2">
                        <div class="card-title">üè∑Ô∏è Spend by Provider</div>
                        <div style="display:flex;gap:24px;align-items:center">
                            <div id="b-provider-donut" style="flex-shrink:0"></div>
                            <div class="bar-chart" id="b-provider-chart" style="flex:1">
                                <div class="empty-state">
                                    <p>No provider data yet</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">‚è±Ô∏è Agent Runtime Controls</div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:end">
                        <div>
                            <div style="font-size:11px;color:var(--text3);margin-bottom:6px">Max Runtime per Session
                                (minutes)</div>
                            <div style="display:flex;align-items:center;gap:10px">
                                <input type="number" id="b-max-runtime" class="field-input" min="0" max="480" value="0"
                                    style="width:100px" placeholder="0 = unlimited" oninput="markRuntimeDirty()">
                                <span style="font-size:11px;color:var(--text3)">0 = unlimited</span>
                            </div>
                            <div style="font-size:10px;color:var(--text3);margin-top:4px">Blocks agent API access after
                                limit expires. Agent process is not killed.</div>
                        </div>
                        <div>
                            <button class="btn-primary" style="font-size:12px;height:36px"
                                onclick="saveRuntimeLimit()">Save Runtime Limit</button>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">üïê Work Hours Restriction</div>
                    <div style="display:flex;align-items:center;gap:12px">
                        <label class="toggle"><input type="checkbox" id="workhours-toggle"
                                onchange="updateWorkHours()"><span class="toggle-slider"></span></label>
                        <span style="font-size:12px;color:var(--text2)" id="workhours-label">Off ‚Äî agents run
                            24/7</span>
                    </div>
                </div>
            </div>

            <!-- PANEL: VAULT -->
            <div id="panel-vault" class="panel">
                <div class="panel-header">
                    <div class="panel-title">üîê Secure Vault</div>
                </div>
                <div class="card">
                    <div class="card-title">üóùÔ∏è Seal a New Secret</div>
                    <div class="vault-form" style="grid-template-columns:1fr 1fr 1fr 2fr auto">
                        <div><label>Type</label><select id="seal-type">
                                <option value="api_key">üîë API Key</option>
                                <option value="password">üîí Password</option>
                                <option value="passkey">ü™™ Passkey</option>
                                <option value="token">üé´ Token</option>
                                <option value="certificate">üìú Certificate</option>
                                <option value="other">üì¶ Other</option>
                            </select></div>
                        <div><label>Provider / ID</label><select id="seal-provider">
                                <option value="openai">openai</option>
                                <option value="anthropic">anthropic</option>
                                <option value="google">google</option>
                                <option value="azure">azure</option>
                                <option value="mistral">mistral</option>
                                <option value="together">together</option>
                                <option value="perplexity">perplexity</option>
                                <option value="groq">groq</option>
                                <option value="deepseek">deepseek</option>
                                <option value="cohere">cohere</option>
                                <option value="voyage">voyage</option>
                                <option value="fireworks">fireworks</option>
                                <option value="openrouter">openrouter</option>
                                <option value="aws">aws</option>
                                <option value="github">github</option>
                                <option value="custom">custom</option>
                            </select></div>
                        <div><label>Label (Optional)</label><input type="text" id="seal-label"
                                placeholder="e.g. My Prod Key"></div>
                        <div><label>Secret Value</label><input type="password" id="seal-key"
                                placeholder="sk-... / password / token"></div>
                        <button class="seal-btn" onclick="sealKey()">üîí SEAL</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">üîí Sealed Secrets</div>
                    <div id="secrets-list">
                        <div class="empty-state">
                            <p>No secrets sealed yet</p>
                        </div>
                    </div>
                    <div class="vault-banner">üõ°Ô∏è Agents don't need these secrets. Raypher injects them into
                        authorized requests automatically. Store API keys, passwords, passkeys, and tokens securely.
                    </div>
                </div>
            </div>

            <!-- PANEL: DLP -->
            <div id="panel-dlp" class="panel">
                <div class="panel-header">
                    <div class="panel-title">üõ°Ô∏è Data Loss Prevention</div>
                </div>

                <!-- DLP Stats Overview -->
                <div class="dlp-overview">
                    <div class="dlp-stat-card">
                        <div class="dlp-stat-big" id="dlp-total" style="color:var(--cyan)">0</div>
                        <div class="dlp-stat-label">Total Findings</div>
                    </div>
                    <div class="dlp-stat-card">
                        <div class="dlp-stat-big" id="dlp-blocked" style="color:var(--red)">0</div>
                        <div class="dlp-stat-label">Blocked / Redacted</div>
                    </div>
                    <div class="dlp-stat-card">
                        <div class="dlp-stat-big" id="dlp-patterns" style="color:var(--green)">11</div>
                        <div class="dlp-stat-label">Active Patterns</div>
                    </div>
                </div>

                <!-- Category Breakdown -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px">
                    <div class="card">
                        <div class="card-title">üìä Findings by Category</div>
                        <div class="dlp-donut-container">
                            <div id="dlp-donut"></div>
                            <div class="dlp-legend" id="dlp-legend"></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">‚öôÔ∏è DLP Configuration</div>
                        <div class="dlp-config-grid" id="dlp-config-grid"></div>
                    </div>
                </div>

                <!-- Recent Findings -->
                <div class="card">
                    <div class="card-title">üìã Recent Findings</div>
                    <div class="dlp-finding-header dlp-finding-row">
                        <span>Timestamp</span>
                        <span>Direction</span>
                        <span>Category</span>
                        <span>Pattern</span>
                        <span>Provider</span>
                        <span>Action</span>
                    </div>
                    <div id="dlp-findings-list">
                        <div class="empty-state">
                            <p>No DLP findings yet. The scanner will detect sensitive data in AI agent traffic
                                automatically.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PANEL: SETTINGS -->
            <div id="panel-settings" class="panel">
                <div class="panel-header">
                    <div class="panel-title">‚öôÔ∏è System Configuration</div>
                </div>
                <div class="card">
                    <div id="settings-sections"></div>
                    <div class="save-bar">
                        <button class="btn-secondary" onclick="loadConfig()">Reset</button>
                        <button class="btn-primary" id="save-config-btn" onclick="saveConfig()" disabled>Save
                            Changes</button>
                    </div>
                </div>
            </div>

        </div><!-- main -->
    </div><!-- shell -->

    <!-- TOAST -->
    <div class="toast-container" id="toasts"></div>

    <!-- PANIC MODAL -->
    <div class="modal-overlay" id="panic-modal">
        <div class="modal">
            <h2>‚ö° FREEZE ALL AGENTS</h2>
            <p>This will immediately terminate all detected AI processes. This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closePanicModal()">Cancel</button>
                <button class="panic-btn" onclick="executePanic()" style="font-size:13px">FREEZE NOW</button>
            </div>
        </div>
    </div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        //  Raypher Command Center ‚Äî Client Logic (Sidebar Nav Edition)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let allAgents = [], selectedAgent = null, policyData = null, configData = null, configDirty = false, agentPids = [], detailFilter = 'all';

        // ‚îÄ‚îÄ Nav Switching ‚îÄ‚îÄ
        function switchPanel(name) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const panel = document.getElementById('panel-' + name);
            if (panel) panel.classList.add('active');
            const nav = document.querySelector('.nav-item[data-panel="' + name + '"]');
            if (nav) nav.classList.add('active');
            if (name === 'agents') loadAgents();
            if (name === 'zones') loadPolicy();
            if (name === 'budget') loadBudget();
            if (name === 'vault') loadSecrets();
            if (name === 'dlp') loadDlp();
            if (name === 'discovery') loadDiscovery();
            if (name === 'merkle') loadMerkle();
            if (name === 'settings') loadConfig();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && e.key >= '1' && e.key <= '6') {
                e.preventDefault();
                const panels = ['agents', 'zones', 'budget', 'vault', 'dlp', 'settings'];
                switchPanel(panels[parseInt(e.key) - 1]);
            }
            if (e.key === 'Escape') { closePanicModal(); if (selectedAgent) switchPanel('agents'); }
        });

        // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
        function toast(msg, type = 'success') {
            const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è' };
            const el = document.createElement('div');
            el.className = 'toast ' + type;
            el.innerHTML = (icons[type] || '') + ' ' + msg;
            document.getElementById('toasts').appendChild(el);
            setTimeout(() => el.remove(), 4000);
        }

        // ‚îÄ‚îÄ API ‚îÄ‚îÄ
        async function api(path, opts) {
            try { const r = await fetch(path, opts); return await r.json(); } catch (e) { return null; }
        }

        // ‚îÄ‚îÄ Status ‚îÄ‚îÄ
        async function loadStatus() {
            const d = await api('/api/status');
            if (!d) return;
            document.getElementById('stat-events').textContent = d.event_count;
            document.getElementById('stat-secrets').textContent = d.secret_count;
            document.getElementById('stat-version').textContent = 'v' + d.version;
            const h = Math.floor(d.uptime_secs / 3600), m = Math.floor((d.uptime_secs % 3600) / 60);
            document.getElementById('stat-uptime').textContent = h + 'h ' + m + 'm';
        }

        // ‚îÄ‚îÄ Agents Grid ‚îÄ‚îÄ
        async function loadAgents() {
            const d = await api('/api/agents');
            const grid = document.getElementById('agent-grid');
            if (!d || !d.agents || d.agents.length === 0) {
                grid.innerHTML = '<div class="agent-empty-state"><p>No AI agents detected ‚Äî start your agents!</p></div>';
                allAgents = []; agentPids = []; return;
            }
            allAgents = d.agents;
            agentPids = d.agents.flatMap(a => a.child_pids || [a.pid]);
            let html = '';
            for (const a of d.agents) {
                const r = String(a.risk_level || 'None');
                const cls = r === 'High' || r === 'Critical' ? 'danger' : r === 'Medium' ? 'warn' : 'safe';
                const label = r === 'None' ? 'üü¢ Protected' : r === 'Medium' ? 'üü° Warning' : 'üî¥ UNMANAGED';
                const count = a.process_count || 1;
                const countLabel = count > 1 ? ' <span style="font-size:10px;color:var(--cyan);font-weight:700">√ó' + count + '</span>' : '';
                // Phase 5: Display friendly name and trust score
                const displayName = a.friendly_name || a.name;
                const trustScore = a.trust_score || 850;
                const trustColor = a.trust_color || '#10b981';
                const trustLabel = a.trust_label || 'High Trust';
                html += '<div class="agent-tile" onclick="openAgentDetail(' + a.pid + ')">' +
                    '<div class="agent-tile-header">' +
                    '<div class="agent-dot ' + cls + '"></div>' +
                    '<div class="agent-tile-name">' + displayName + countLabel + '</div>' +
                    '<div class="agent-tile-pid">PID: ' + a.pid + '</div>' +
                    '</div>' +
                    '<div class="agent-tile-meta"><span>üíæ ' + (a.memory_mb || 0) + ' MB</span>' + (count > 1 ? '<span>üîó ' + count + ' processes</span>' : '') + '</div>' +
                    '<div class="agent-tile-risk ' + cls + '">' + label + '</div>' +
                    '<div style="padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-top:1px solid rgba(148,163,184,.07)">' +
                    '<span style="font-size:10px;color:var(--text3)">Trust Score</span>' +
                    '<span style="font-size:11px;font-weight:700;color:' + trustColor + '">' + trustScore + ' ‚Äî ' + trustLabel + '</span>' +
                    '</div>' +
                    '</div>';
            }
            grid.innerHTML = html;
        }

        // ‚îÄ‚îÄ Agent Detail ‚îÄ‚îÄ
        function openAgentDetail(pid) {
            const agent = allAgents.find(a => a.pid === pid);
            if (!agent) return;
            selectedAgent = agent;
            const r = String(agent.risk_level || 'None');
            const cls = r === 'High' || r === 'Critical' ? 'danger' : r === 'Medium' ? 'warn' : 'safe';
            const label = r === 'None' ? 'üü¢ Protected' : r === 'Medium' ? 'üü° Warning' : 'üî¥ UNMANAGED';
            const displayName = agent.friendly_name || agent.name;
            document.getElementById('detail-name').textContent = displayName + ' (PID: ' + agent.pid + ')';
            const badge = document.getElementById('detail-risk-badge');
            badge.textContent = label; badge.className = 'agent-tile-risk ' + cls;
            document.getElementById('detail-risk-reason').textContent = agent.risk_reason || '';
            document.getElementById('detail-pid').textContent = agent.pid;
            document.getElementById('detail-mem').textContent = (agent.memory_mb || 0) + ' MB';
            document.getElementById('detail-cmd').textContent = agent.cmd || '‚Äî';
            // Phase 5: Use real trust score from backend (not derived from risk level)
            const score = agent.trust_score || (r === 'None' ? 850 : r === 'Medium' ? 500 : r === 'High' ? 250 : 100);
            const arc = Math.min(204, score / 1000 * 204);
            document.getElementById('detail-gauge-arc').setAttribute('stroke-dasharray', arc + ' 204');
            document.getElementById('detail-trust').textContent = score;
            document.getElementById('detail-trust-lbl').textContent = agent.trust_label || (score >= 700 ? 'High Trust' : score >= 300 ? 'Moderate' : 'Low Trust');
            // Show panel
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.getElementById('panel-agent-detail').classList.add('active');
            detailFilter = 'all';
            loadDetailEvents();
            loadSecurityInsights(agent);
        }

        async function loadDetailEvents() {
            const d = await api('/api/events?limit=100');
            const container = document.getElementById('detail-timeline');
            if (!d || !d.events || d.events.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No events recorded yet</p></div>'; return;
            }
            let html = '';
            for (const ev of d.events) {
                const show = detailFilter === 'all' || ev.severity === detailFilter;
                // Phase 5: Use formatted_time and description from backend
                const ts = ev.formatted_time || (ev.timestamp ? (ev.timestamp.length > 19 ? ev.timestamp.substring(11, 19) : ev.timestamp) : '');
                const description = ev.description || ev.details || '';
                const shortDesc = description.length > 120 ? description.substring(0, 120) + '‚Ä¶' : description;
                html += '<div class="event-row" style="display:' + (show ? 'block' : 'none') + '" data-severity="' + ev.severity + '" onclick="this.classList.toggle(\'expanded\')">' +
                    '<div class="event-dot ' + ev.severity + '"></div>' +
                    '<div class="event-header">' +
                    '<span class="event-type">' + ev.event_type + '</span>' +
                    '<span class="event-badge ' + ev.severity + '">' + ev.severity + '</span>' +
                    '<span class="event-time">' + ts + '</span>' +
                    '</div>' +
                    '<div class="event-detail">' + shortDesc + '</div>' +
                    '<div class="event-expand">' + (ev.details || '') + '</div>' +
                    '</div>';
            }
            container.innerHTML = html;
        }

        function filterDetailEvents(filter, btn) {
            detailFilter = filter;
            document.querySelectorAll('#detail-filters .filter-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            document.querySelectorAll('#detail-timeline .event-row').forEach(row => {
                const sev = row.dataset.severity;
                row.style.display = (filter === 'all' || sev === filter) ? 'block' : 'none';
            });
        }

        function loadSecurityInsights(agent) {
            const r = String(agent.risk_level || 'None');
            let html = '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">';
            html += '<div class="detail-stat"><div class="detail-stat-val" style="font-size:14px">' + (r === 'None' ? '‚úÖ Clean' : '‚ö†Ô∏è Flagged') + '</div><div class="detail-stat-lbl">Risk Status</div></div>';
            html += '<div class="detail-stat"><div class="detail-stat-val" style="font-size:14px">' + (agent.memory_mb || 0) + ' MB</div><div class="detail-stat-lbl">Memory Usage</div></div>';
            html += '<div class="detail-stat"><div class="detail-stat-val" style="font-size:14px">Active</div><div class="detail-stat-lbl">Process State</div></div>';
            html += '<div class="detail-stat"><div class="detail-stat-val" style="font-size:14px">' + (agent.risk_reason || 'None') + '</div><div class="detail-stat-lbl">Risk Trigger</div></div>';
            html += '</div>';
            document.getElementById('detail-insights').innerHTML = html;
        }

        async function freezeSelectedAgent() {
            if (!selectedAgent) return;
            if (!confirm('Freeze agent PID ' + selectedAgent.pid + '?')) return;
            const r = await api('/api/panic', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ pids: [selectedAgent.pid] }) });
            if (r) { toast('Frozen agent PID ' + selectedAgent.pid); switchPanel('agents'); }
        }

        // ‚îÄ‚îÄ Zones (Kanban) ‚îÄ‚îÄ
        async function loadPolicy() {
            const d = await api('/api/config/policy');
            if (!d) return;
            policyData = d;
            renderKanban();
        }

        function renderKanban() {
            if (!policyData || !policyData.capabilities) return;
            const cols = { allowed: [], ask_me: [], blocked: [] };
            for (const c of policyData.capabilities) {
                const z = c.zone || 'blocked';
                if (!cols[z]) cols[z] = [];
                cols[z].push(c);
            }
            for (const [zone, caps] of Object.entries(cols)) {
                const zoneId = zone === 'ask_me' ? 'askme' : zone;
                const container = document.getElementById('cards-' + zoneId);
                if (!container) continue;
                container.innerHTML = '';
                for (const c of caps) {
                    const el = document.createElement('div');
                    el.className = 'cap-card'; el.draggable = true; el.dataset.id = c.id;
                    el.innerHTML = '<div class="cap-card-info"><div class="cap-card-name">' + c.name + '</div><div class="cap-card-desc">' + (c.description || '') + '</div></div>' +
                        '<button class="cap-remove" onclick="event.stopPropagation();removeCap(\'' + c.id + '\')" title="Remove">‚úï</button>';
                    el.addEventListener('dragstart', e => { e.dataTransfer.setData('text/plain', c.id); el.classList.add('dragging'); });
                    el.addEventListener('dragend', () => el.classList.remove('dragging'));
                    container.appendChild(el);
                }
            }
        }

        function dropCap(e, newZone) {
            e.preventDefault(); e.currentTarget.classList.remove('drag-over');
            const capId = e.dataTransfer.getData('text/plain');
            if (!policyData) return;
            const cap = policyData.capabilities.find(c => c.id === capId);
            if (cap) { cap.zone = newZone; renderKanban(); savePolicy(); }
        }

        function addCapability(e, zone) {
            if (e.key !== 'Enter') return;
            const val = e.target.value.trim();
            if (!val || !policyData) return;
            e.target.value = '';
            const id = val.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
            if (policyData.capabilities.find(c => c.id === id)) { toast('Capability already exists', 'warning'); return; }
            policyData.capabilities.push({ id: id, name: val, description: 'Custom capability', zone: zone });
            renderKanban(); savePolicy(); toast('Added "' + val + '" to ' + zone);
        }

        function removeCap(capId) {
            if (!policyData) return;
            policyData.capabilities = policyData.capabilities.filter(c => c.id !== capId);
            renderKanban(); savePolicy(); toast('Capability removed');
        }

        async function savePolicy() {
            if (!policyData) return;
            const r = await api('/api/config/policy/update', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(policyData) });
            if (r && r.status === 'saved') { } else toast('Failed to save policy', 'error');
        }

        // ‚îÄ‚îÄ Budget ‚îÄ‚îÄ
        async function loadBudget() {
            const d = await api('/api/stats/spend');
            if (!d) return;

            document.getElementById('b-daily-spend').textContent = '$' + (d.daily_spend || 0).toFixed(4);
            document.getElementById('b-daily-limit').textContent = '$' + (d.budget_limit || 50).toFixed(2);
            const pct = d.percentage || 0;
            const fill = document.getElementById('b-daily-fill');
            fill.style.width = pct + '%';
            fill.style.background = pct > 80 ? 'var(--red)' : pct > 50 ? 'var(--amber)' : 'linear-gradient(90deg,var(--green),var(--cyan))';

            document.getElementById('b-monthly').textContent = '$' + (d.daily_spend * 30).toFixed(2);
            document.getElementById('b-slider').value = d.budget_limit;
            // Phase 5: populate max runtime from policy
            if (policyData && policyData.budget && policyData.budget.max_runtime_minutes !== undefined) {
                document.getElementById('b-max-runtime').value = policyData.budget.max_runtime_minutes;
            }

            // Hourly Chart (SVG)
            const hourlyChart = document.getElementById('b-hourly-chart');
            if (d.hourly_breakdown && d.hourly_breakdown.length > 0) {
                hourlyChart.innerHTML = renderBarChart(d.hourly_breakdown, 'hour', 'cost', '#60a5fa');
            } else {
                hourlyChart.innerHTML = '<div class="empty-state"><p>No spend yet today ‚Äî route API calls through the proxy</p></div>';
            }

            // Daily Chart (SVG)
            const dailyChart = document.getElementById('b-daily-chart');
            if (d.daily_breakdown && d.daily_breakdown.length > 0) {
                const dailyData = d.daily_breakdown.map(day => ({
                    label: day.day.substring(5), // "MM-DD"
                    value: day.cost
                }));
                dailyChart.innerHTML = renderBarChart(dailyData, 'label', 'value', '#a78bfa');
            } else {
                dailyChart.innerHTML = '<div class="empty-state"><p>No daily data available</p></div>';
            }

            // Provider Chart (SVG)
            const providerChart = document.getElementById('b-provider-chart');
            if (d.provider_breakdown && d.provider_breakdown.length > 0) {
                providerChart.innerHTML = renderBarChart(d.provider_breakdown, 'provider', 'cost', '#34d399');
                renderDonut('b-provider-donut', d.provider_breakdown);
            } else {
                providerChart.innerHTML = '<div class="empty-state"><p>No provider data</p></div>';
                document.getElementById('b-provider-donut').innerHTML = '';
            }
        }

        function renderBarChart(data, labelKey, valueKey, color) {
            const width = 400, height = 120, padding = 20;
            const maxVal = Math.max(...data.map(d => d[valueKey]), 0.1);
            const barWidth = (width - padding * 2) / data.length;

            let svg = `<svg width="100%" height="100%" viewBox="0 0 ${width} ${height}" preserveAspectRatio="none">`;
            data.forEach((d, i) => {
                const barHeight = (d[valueKey] / maxVal) * (height - padding * 1.5);
                const x = padding + i * barWidth;
                const y = height - padding - barHeight;
                svg += `<rect x="${x + 2}" y="${y}" width="${barWidth - 4}" height="${barHeight}" fill="${color}" rx="2" style="transition:all .3s">
                         <title>${d[labelKey]}: $${d[valueKey].toFixed(4)}</title>
                       </rect>`;
                // Label
                if (data.length <= 12 || i % 2 === 0) {
                    svg += `<text x="${x + barWidth / 2}" y="${height - 5}" text-anchor="middle" fill="#94a3b8" font-size="8" font-family="Inter">${d[labelKey]}</text>`;
                }
            });
            svg += '</svg>';
            return svg;
        }

        async function updateBudgetSlider(val) {
            document.getElementById('b-daily-limit').textContent = '$' + val + '.00';
            if (policyData) {
                policyData.budget = policyData.budget || {};
                policyData.budget.daily_limit_usd = parseFloat(val);
                // Also update the legacy field for compatibility
                policyData.daily_budget_limit = parseFloat(val);
                await savePolicy();
                loadBudget();
            }
        }

        function updateWorkHours() {
            const on = document.getElementById('workhours-toggle').checked;
            document.getElementById('workhours-label').textContent = on ? '9:00 AM ‚Äì 5:00 PM' : 'Off ‚Äî agents run 24/7';
            if (policyData) { policyData.work_hours_only = on; savePolicy(); }
        }

        // Phase 5: Agent Runtime Controls helpers
        function markRuntimeDirty() {
            // Provides instant feedback that the input changed
            const btn = document.querySelector('[onclick="saveRuntimeLimit()"]');
            if (btn) btn.textContent = 'üíæ Save Runtime Limit*';
        }

        async function saveRuntimeLimit() {
            const val = parseInt(document.getElementById('b-max-runtime').value, 10) || 0;
            if (!policyData) { toast('Policy not loaded', 'warning'); return; }
            policyData.budget = policyData.budget || {};
            policyData.budget.max_runtime_minutes = val;
            await savePolicy();
            const btn = document.querySelector('[onclick="saveRuntimeLimit()"]');
            if (btn) btn.textContent = 'Save Runtime Limit';
            toast('‚úÖ Runtime limit ' + (val === 0 ? 'disabled (unlimited)' : 'set to ' + val + ' min'));
        }

        // ‚îÄ‚îÄ Vault ‚îÄ‚îÄ
        const SECRET_ICONS = { api_key: 'üîë', password: 'üîí', passkey: 'ü™™', token: 'üé´', certificate: 'üìú', other: 'üì¶' };
        async function loadSecrets() {
            const d = await api('/api/secrets');
            const list = document.getElementById('secrets-list');
            if (!d || !d.secrets || d.secrets.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>No secrets sealed yet</p></div>'; return;
            }
            let html = '';
            for (const s of d.secrets) {
                const date = s.created_at ? s.created_at.substring(0, 10) : '';
                const icon = SECRET_ICONS[s.secret_type] || 'üîë';
                const typeLabel = (s.secret_type || 'api_key').replace('_', ' ');
                html += '<div class="secret-row"><div class="secret-icon">' + icon + '</div><div class="secret-info"><div class="secret-provider">' + s.provider + (s.label && s.label !== s.provider ? ' <span style="color:var(--text3);font-size:10px">(' + s.label + ')</span>' : '') + '</div><div class="secret-date">' + typeLabel + ' ¬∑ Sealed ' + date + '</div></div><span class="secret-badge">üîí Sealed</span><button class="secret-delete" onclick="deleteSecret(\'' + s.provider + '\')">Delete</button></div>';
            }
            list.innerHTML = html;
        }

        async function renderDonut(containerId, providers) {
            const total = providers.reduce((s, p) => s + (p.cost || 0), 0);
            if (total === 0) return;
            const colors = ['#3b82f6', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444'];
            let offset = 0, paths = '', legend = '';
            const r = 50, cx = 60, cy = 60, circumference = 2 * Math.PI * r;
            for (let i = 0; i < providers.length; i++) {
                const pct = providers[i].cost / total;
                const dash = pct * circumference;
                const color = colors[i % colors.length];
                paths += `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="${color}" stroke-width="18" stroke-dasharray="${dash} ${circumference - dash}" stroke-dashoffset="${-offset}" transform="rotate(-90 ${cx} ${cy})"/>`;
                offset += dash;
                legend += `<div style="display:flex;align-items:center;gap:6px;font-size:10px"><div style="width:8px;height:8px;border-radius:2px;background:${color}"></div><span style="color:var(--text2)">${providers[i].provider}</span><span style="color:var(--text3);margin-left:auto">$${providers[i].cost.toFixed(4)}</span></div>`;
            }
            document.getElementById(containerId).innerHTML = `<svg viewBox="0 0 120 120" width="120" height="120">${paths}<text x="${cx}" y="${cy + 4}" text-anchor="middle" fill="var(--text)" font-size="12" font-weight="700" font-family="JetBrains Mono">$${total.toFixed(2)}</text></svg><div style="margin-top:8px">${legend}</div>`;
        }

        async function sealKey() {
            const provider = document.getElementById('seal-provider').value;
            const key = document.getElementById('seal-key').value;
            const secretType = document.getElementById('seal-type').value;
            const label = document.getElementById('seal-label').value;
            if (!key) { toast('Enter a secret value', 'warning'); return; }
            const r = await api('/api/secrets/seal', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    provider,
                    key,
                    secret_type: secretType,
                    label: label || null
                })
            });
            if (r && r.status === 'sealed') {
                toast('üîí Secret sealed for ' + provider);
                document.getElementById('seal-key').value = '';
                document.getElementById('seal-label').value = '';
                loadSecrets();
                loadStatus();
            }
            else toast(r?.error || 'Seal failed', 'error');
        }

        async function deleteSecret(provider) {
            if (!confirm('Delete sealed key for "' + provider + '"?')) return;
            const r = await api('/api/secrets/' + encodeURIComponent(provider), { method: 'DELETE' });
            if (r && r.status === 'deleted') { toast('Key deleted'); loadSecrets(); loadStatus(); }
            else toast(r?.error || 'Delete failed', 'error');
        }

        // ‚îÄ‚îÄ Settings ‚îÄ‚îÄ
        async function loadConfig() {
            const d = await api('/api/config');
            if (!d) return;
            configData = JSON.parse(JSON.stringify(d));
            const sections = [
                {
                    name: 'Proxy', key: 'proxy', fields: [
                        { label: 'Listen Address', key: 'listen_addr', type: 'text', readonly: true },
                        { label: 'Listen Port', key: 'listen_port', type: 'number', readonly: true },
                        { label: 'Upstream URL', key: 'default_upstream', type: 'text' },
                        { label: 'Rate Limit (req/min)', key: 'rate_limit_per_minute', type: 'number' },
                    ]
                },
                {
                    name: 'Watchtower', key: 'watchtower', fields: [
                        { label: 'Scan Interval (sec)', key: 'scan_interval_secs', type: 'number' },
                        { label: 'Alert Threshold', key: 'alert_threshold', type: 'select', options: ['None', 'Low', 'Medium', 'High', 'Critical'] },
                    ]
                },
                {
                    name: 'Logging', key: 'logging', fields: [
                        { label: 'Log Level', key: 'level', type: 'select', options: ['trace', 'debug', 'info', 'warn', 'error'] },
                        { label: 'Log Directory', key: 'log_dir', type: 'text' },
                        { label: 'Retention (days)', key: 'retention_days', type: 'number' },
                    ]
                },
                {
                    name: 'Updater', key: 'updater', fields: [
                        { label: 'Auto-Update', key: 'enabled', type: 'toggle' },
                        { label: 'Check Interval (hrs)', key: 'check_interval_hours', type: 'number' },
                    ]
                },
            ];
            let html = '';
            for (const sec of sections) {
                html += '<div class="settings-section"><div class="settings-header" onclick="this.parentElement.classList.toggle(\'open\')"><h3>' + sec.name + '</h3><span class="settings-chevron">‚ñ∂</span></div><div class="settings-body">';
                for (const f of sec.fields) {
                    const val = d[sec.key]?.[f.key] ?? '';
                    html += '<div class="field-row"><div><div class="field-label">' + f.label + '</div></div>';
                    if (f.type === 'select') {
                        html += '<select class="field-select" data-section="' + sec.key + '" data-key="' + f.key + '" onchange="markDirty()">';
                        for (const o of f.options) html += '<option' + (o === String(val) ? ' selected' : '') + '>' + o + '</option>';
                        html += '</select>';
                    } else if (f.type === 'toggle') {
                        html += '<label class="toggle"><input type="checkbox" data-section="' + sec.key + '" data-key="' + f.key + '"' + (val ? ' checked' : '') + ' onchange="markDirty()"><span class="toggle-slider"></span></label>';
                    } else {
                        html += '<input class="field-input" type="' + f.type + '" value="' + val + '" data-section="' + sec.key + '" data-key="' + f.key + '"' + (f.readonly ? ' readonly style="opacity:.5"' : ' oninput="markDirty()"') + '>';
                    }
                    html += '</div>';
                }
                html += '</div></div>';
            }
            document.getElementById('settings-sections').innerHTML = html;
            configDirty = false; document.getElementById('save-config-btn').disabled = true;
        }

        function markDirty() { configDirty = true; document.getElementById('save-config-btn').disabled = false; }

        async function saveConfig() {
            if (!configDirty) return;
            const payload = {};
            document.querySelectorAll('.field-input:not([readonly]), .field-select, .toggle input').forEach(el => {
                const sec = el.dataset.section, key = el.dataset.key;
                if (!sec || !key) return;
                if (!payload[sec]) payload[sec] = {};
                if (el.type === 'checkbox') payload[sec][key] = el.checked;
                else if (el.type === 'number') payload[sec][key] = parseInt(el.value) || 0;
                else payload[sec][key] = el.value;
            });
            const r = await api('/api/config/update', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (r && r.status === 'saved') { toast('Configuration saved'); configDirty = false; document.getElementById('save-config-btn').disabled = true; }
            else toast(r?.error || 'Save failed', 'error');
        }

        // ‚îÄ‚îÄ DLP ‚îÄ‚îÄ
        const dlpCategoryColors = {
            'api_keys': '#f87171',
            'financial': '#fbbf24',
            'pii': '#a78bfa',
            'crypto_material': '#f472b6',
            'entropy': '#22d3ee',
            'custom': '#34d399',
        };

        function renderDlpDonut(categories) {
            if (!categories || categories.length === 0) {
                return '<svg width="120" height="120" viewBox="0 0 120 120"><circle cx="60" cy="60" r="50" fill="none" stroke="rgba(148,163,184,.1)" stroke-width="12"/><text x="60" y="64" text-anchor="middle" fill="#94a3b8" font-size="11" font-family="Inter">No data</text></svg>';
            }
            const total = categories.reduce((s, c) => s + c.count, 0);
            if (total === 0) return '<svg width="120" height="120" viewBox="0 0 120 120"><circle cx="60" cy="60" r="50" fill="none" stroke="rgba(148,163,184,.1)" stroke-width="12"/><text x="60" y="64" text-anchor="middle" fill="#94a3b8" font-size="11" font-family="Inter">No data</text></svg>';

            let svg = '<svg width="120" height="120" viewBox="0 0 120 120">';
            const r = 50, cx = 60, cy = 60;
            const circ = 2 * Math.PI * r;
            let offset = 0;

            categories.forEach(cat => {
                const pct = cat.count / total;
                const dashLen = pct * circ;
                const color = dlpCategoryColors[cat.category] || '#94a3b8';
                svg += `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="${color}" stroke-width="12" stroke-dasharray="${dashLen} ${circ - dashLen}" stroke-dashoffset="${-offset}" transform="rotate(-90 ${cx} ${cy})" style="transition:all .5s"/>`;
                offset += dashLen;
            });

            svg += `<text x="${cx}" y="${cy - 4}" text-anchor="middle" fill="white" font-size="20" font-weight="800" font-family="Inter">${total}</text>`;
            svg += `<text x="${cx}" y="${cy + 12}" text-anchor="middle" fill="#94a3b8" font-size="9" font-family="Inter">TOTAL</text>`;
            svg += '</svg>';
            return svg;
        }

        async function loadDlp() {
            const [stats, findings, config] = await Promise.all([
                api('/api/dlp/stats'),
                api('/api/dlp/findings'),
                api('/api/dlp/config'),
            ]);

            // ‚Äî Stats cards ‚Äî
            if (stats) {
                const categories = stats.categories || [];
                const total = categories.reduce((s, c) => s + (c.count || 0), 0);
                const blocked = categories.reduce((s, c) => s + (c.blocked || 0), 0);
                document.getElementById('dlp-total').textContent = total;
                document.getElementById('dlp-blocked').textContent = blocked;

                // Donut
                document.getElementById('dlp-donut').innerHTML = renderDlpDonut(categories);

                // Active patterns count from config
                if (config && config.built_in_patterns) {
                    document.getElementById('dlp-patterns').textContent = config.built_in_patterns + (config.custom_patterns ? ' + ' + config.custom_patterns.length + ' custom' : '');
                }

                // Legend
                const legendEl = document.getElementById('dlp-legend');
                if (categories.length > 0) {
                    legendEl.innerHTML = categories.map(c => {
                        const color = dlpCategoryColors[c.category] || '#94a3b8';
                        const name = (c.category || 'unknown').replace(/_/g, ' ');
                        return `<div class="dlp-legend-item"><div class="dlp-legend-dot" style="background:${color}"></div>${name}: <b style="color:var(--text)">${c.count}</b></div>`;
                    }).join('');
                } else {
                    legendEl.innerHTML = '<div class="dlp-legend-item" style="color:var(--text3)">No categories detected</div>';
                }
            }

            // ‚Äî Config (built-in) ‚Äî
            if (config) {
                const grid = document.getElementById('dlp-config-grid');
                const items = [
                    { label: 'Default Action', value: config.default_action || 'alert' },
                    { label: 'API Keys', value: config.api_keys || 'redact' },
                    { label: 'Financial', value: config.financial || 'redact' },
                    { label: 'PII', value: config.pii || 'alert' },
                    { label: 'Crypto Material', value: config.crypto_material || 'block' },
                    { label: 'Entropy Detection', value: config.entropy_detection ? 'enabled' : 'disabled' },
                ];
                grid.innerHTML = items.map(i => {
                    const actionClass = ['redact', 'block', 'alert', 'allow'].includes(i.value) ? ` dlp-action-${i.value}` : '';
                    return `<div class="dlp-config-item"><span class="dlp-config-label">${i.label}</span><span class="dlp-action-badge${actionClass}">${i.value}</span></div>`;
                }).join('');

                if (config.exclusions && config.exclusions.length > 0) {
                    grid.innerHTML += `<div class="dlp-config-item" style="grid-column:span 2"><span class="dlp-config-label">Exclusions</span><span class="dlp-config-value">${config.exclusions.join(', ')}</span></div>`;
                }

                // Phase 5: Custom Patterns CRUD
                const customPatterns = config.custom_patterns || [];
                const existingSection = document.getElementById('dlp-custom-patterns-section');
                const section = existingSection || document.createElement('div');
                if (!existingSection) {
                    section.id = 'dlp-custom-patterns-section';
                    section.className = 'card';
                    document.getElementById('dlp-config-grid').closest('.card').after(section);
                }
                section.innerHTML = `<div class="card-title">üîç Custom DLP Patterns
                    <button class="btn-secondary" style="font-size:11px;padding:4px 10px;margin-left:auto" onclick="loadDlp()">Refresh</button>
                </div>
                <div style="margin-bottom:12px;display:grid;grid-template-columns:1fr 1fr auto auto;gap:8px;align-items:end">
                    <div><div style="font-size:11px;color:var(--text3);margin-bottom:4px">Name</div><input id="dlp-new-name" class="field-input" type="text" placeholder="e.g., Internal API" style="width:100%"></div>
                    <div><div style="font-size:11px;color:var(--text3);margin-bottom:4px">Regex Pattern</div><input id="dlp-new-pattern" class="field-input" type="text" placeholder="e.g., INTERNAL-[A-Z0-9]+" style="width:100%"></div>
                    <div><div style="font-size:11px;color:var(--text3);margin-bottom:4px">Severity</div><select id="dlp-new-severity" class="field-select"><option>Medium</option><option>High</option><option>Critical</option><option>Low</option></select></div>
                    <button class="btn-primary" style="font-size:12px;height:36px" onclick="addDlpPattern()">+ Add Pattern</button>
                </div>
                <div id="dlp-custom-list">
                ${customPatterns.length === 0
                        ? '<div style="color:var(--text3);font-size:12px;padding:8px 0">No custom patterns. Add one above.</div>'
                        : customPatterns.map(p => `
                        <div style="display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:8px;background:rgba(148,163,184,.04);margin-bottom:6px">
                            <span style="font-weight:600;color:var(--text);min-width:120px">${p.name}</span>
                            <span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--cyan);flex:1">${p.pattern}</span>
                            <span class="dlp-action-badge dlp-action-${(p.severity || 'medium').toLowerCase()}">${p.severity || 'Medium'}</span>
                            <button class="secret-delete" onclick="deleteDlpPattern('${encodeURIComponent(p.name)}')">Delete</button>
                        </div>`).join('')
                    }
                </div>`;
            }

            // ‚Äî Findings feed ‚Äî
            const list = document.getElementById('dlp-findings-list');
            if (findings && findings.length > 0) {
                list.innerHTML = findings.map(f => {
                    const ts = f.timestamp ? new Date(f.timestamp).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' }) : '‚Äî';
                    const dirClass = (f.direction || '').toLowerCase() === 'outbound' ? 'dlp-dir-outbound' : 'dlp-dir-inbound';
                    const catClass = 'dlp-cat-' + (f.category || 'unknown').toLowerCase().replace(/\s/g, '_');
                    const actionClass = 'dlp-action-' + (f.action_taken || 'alert').toLowerCase();
                    const snippet = f.snippet || '';
                    const provider = f.provider || '‚Äî';

                    return `<div class="dlp-finding-row">
                        <span style="color:var(--text3);font-size:11px;font-family:'JetBrains Mono',monospace">${ts}</span>
                        <span class="dlp-direction ${dirClass}">${f.direction || '‚Äî'}</span>
                        <span class="dlp-category-badge ${catClass}">${(f.category || 'unknown').replace(/_/g, ' ')}</span>
                        <span class="dlp-snippet" title="${snippet}">${f.pattern_name || snippet || '‚Äî'}</span>
                        <span style="color:var(--text2);font-size:11px">${provider}</span>
                        <span class="dlp-action-badge ${actionClass}">${f.action_taken || '‚Äî'}</span>
                    </div>`;
                }).join('');
            } else {
                list.innerHTML = '<div class="empty-state"><p>No DLP findings yet. The scanner will detect sensitive data in AI agent traffic automatically.</p></div>';
            }
        }

        async function addDlpPattern() {
            const name = document.getElementById('dlp-new-name').value.trim();
            const pattern = document.getElementById('dlp-new-pattern').value.trim();
            const severity = document.getElementById('dlp-new-severity').value;
            if (!name || !pattern) { toast('Name and pattern are required', 'warning'); return; }
            const r = await api('/api/dlp/patterns', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, pattern, severity })
            });
            if (r && r.status === 'added') {
                toast('‚úÖ Pattern "' + name + '" added');
                document.getElementById('dlp-new-name').value = '';
                document.getElementById('dlp-new-pattern').value = '';
                loadDlp();
            } else {
                toast(r?.error || 'Failed to add pattern', 'error');
            }
        }

        async function deleteDlpPattern(encodedName) {
            const name = decodeURIComponent(encodedName);
            if (!confirm('Delete pattern "' + name + '"?')) return;
            const r = await api('/api/dlp/patterns/' + encodedName, { method: 'DELETE' });
            if (r && r.status === 'ok') { toast('Pattern deleted'); loadDlp(); }
            else toast(r?.error || 'Delete failed', 'error');
        }

        // ‚îÄ‚îÄ Panic ‚îÄ‚îÄ
        function showPanicModal() { document.getElementById('panic-modal').classList.add('active'); }
        function closePanicModal() { document.getElementById('panic-modal').classList.remove('active'); }
        async function executePanic() {
            closePanicModal();
            if (agentPids.length === 0) { toast('No agents to freeze', 'warning'); return; }
            const r = await api('/api/panic', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ pids: agentPids }) });
            if (r) { toast('Frozen ' + (r.killed?.length || 0) + ' agent(s)', r.killed?.length > 0 ? 'success' : 'warning'); loadAgents(); }
        }

        // ‚îÄ‚îÄ Discovery ‚îÄ‚îÄ
        async function loadDiscovery() {
            const container = document.getElementById('discovery-list');
            container.innerHTML = '<div class="empty-state"><p>üì° Running deep scan (Layer A-D)...</p></div>';

            const d = await api('/api/discovery');
            if (!d || !d.assets || d.assets.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>‚úÖ No unmanaged AI services detected.</p></div>';
                return;
            }

            let html = '<div class="dlp-finding-header dlp-finding-row" style="grid-template-columns: 120px 100px 1fr 120px 80px;">' +
                '<span>Asset Name</span><span>Type</span><span>Detection Reason</span><span>Port / PID</span><span>Risk</span></div>';

            for (const a of d.assets) {
                const risk = a.risk_level >= 8 ? 'Critical' : a.risk_level >= 5 ? 'Medium' : 'Low';
                const actionClass = 'dlp-action-' + (risk === 'Critical' ? 'block' : risk === 'Medium' ? 'redact' : 'allow');

                html += `<div class="dlp-finding-row" style="grid-template-columns: 120px 100px 1fr 120px 80px;">
                    <span style="font-weight:700;color:var(--text)">${a.name}</span>
                    <span style="font-size:10px;text-transform:uppercase;color:var(--cyan)">${a.asset_type}</span>
                    <span style="font-size:11px;color:var(--text2)">${a.description}</span>
                    <span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text3)">${a.port ? 'Port: ' + a.port : 'PID: ' + (a.pid || 'N/A')}</span>
                    <span class="dlp-action-badge ${actionClass}">${risk}</span>
                </div>`;
            }
            container.innerHTML = html;
        }

        // ‚îÄ‚îÄ Merkle Ledger ‚îÄ‚îÄ
        async function loadMerkle() {
            const d = await api('/api/merkle/status');
            if (!d) return;

            const icon = d.valid ? (d.status === 'empty' ? 'üì≠' : '‚úÖ') : 'üö®';
            const text = d.valid
                ? (d.status === 'empty' ? 'No entries yet ‚Äî ledger will populate as requests flow through the proxy.' : 'Chain integrity VERIFIED')
                : 'CHAIN CORRUPTION DETECTED!';
            const color = d.valid ? (d.status === 'empty' ? 'var(--text2)' : 'var(--green)') : 'var(--red)';

            document.getElementById('merkle-status-icon').textContent = icon;
            const statusEl = document.getElementById('merkle-status-text');
            statusEl.textContent = text;
            statusEl.style.color = color;
            document.getElementById('merkle-entry-count').textContent = `${d.entry_count} chained entrie${d.entry_count !== 1 ? 's' : ''} recorded`;
            document.getElementById('merkle-ledger-path').textContent = d.ledger_path || '';

            const errEl = document.getElementById('merkle-error-msg');
            if (d.error) { errEl.style.display = 'block'; errEl.textContent = 'Error: ' + d.error; }
            else errEl.style.display = 'none';

            const entries = d.last_entries || [];
            const entriesEl = document.getElementById('merkle-entries');
            if (entries.length === 0) {
                entriesEl.innerHTML = '<div class="empty-state"><p>No entries in ledger yet.</p></div>';
            } else {
                let html = '<div style="font-family:\'JetBrains Mono\',monospace;font-size:11px">';
                // Phase 5: Added Time and Description columns
                html += '<div style="display:grid;grid-template-columns:40px 140px 1fr 90px 90px;gap:0;padding:6px 10px;color:var(--text3);font-size:10px;border-bottom:1px solid rgba(148,163,184,.1)">';
                html += '<span>#</span><span>Time</span><span>Description</span><span>Event</span><span>Hash</span></div>';
                for (const e of entries) {
                    // Phase 5: Use formatted_time and description from backend
                    const timeStr = e.formatted_time || (e.timestamp ? new Date(e.timestamp * 1000).toLocaleTimeString() : '‚Äî');
                    const description = e.description || e.event || '‚Äî';
                    html += `<div style="display:grid;grid-template-columns:40px 140px 1fr 90px 90px;gap:0;padding:8px 10px;border-bottom:1px solid rgba(148,163,184,.05);align-items:center">`;
                    html += `<span style="color:var(--text3)">${e.seq}</span>`;
                    html += `<span style="color:var(--text3);font-size:10px">${timeStr}</span>`;
                    html += `<span style="color:var(--text2);font-size:11px">${description}</span>`;
                    html += `<span style="color:var(--cyan);font-size:10px">${e.event || '‚Äî'}</span>`;
                    html += `<span style="color:var(--purple)">${e.hash_short || '‚Äî'}‚Ä¶</span>`;
                    html += '</div>';
                }
                html += '</div>';
                entriesEl.innerHTML = html;
            }
        }

        // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
        (async () => {
            await Promise.all([loadStatus(), loadAgents()]);
            loadPolicy();
            setInterval(async () => {
                await loadStatus();
                if (document.getElementById('panel-agents').classList.contains('active')) loadAgents();
                if (document.getElementById('panel-dlp').classList.contains('active')) loadDlp();
                if (document.getElementById('panel-budget').classList.contains('active')) loadBudget();
                if (document.getElementById('panel-merkle').classList.contains('active')) loadMerkle();
            }, 5000);
        })();
    </script>
</body>

</html>